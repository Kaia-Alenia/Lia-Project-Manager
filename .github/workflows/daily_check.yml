import os
import requests
from bs4 import BeautifulSoup
from google import genai  # Nueva librería oficial

# 1. Configuración de Lía (Versión 1.1)
try:
    api_key = os.environ.get("GEMINI_API_KEY")
    client = genai.Client(api_key=api_key) # Nueva forma de conectar
except Exception as e:
    print(f"Error en el hardware de Lía: {e}")
    exit(1)

# 2. Configuración de los Ojos
URL_PERFIL = "https://kaia-alenia.itch.io"
headers = {"User-Agent": "Mozilla/5.0"}

def revisar_perfil():
    try:
        respuesta = requests.get(URL_PERFIL, headers=headers, timeout=15)
        return "Perfil de Kaia Alenia detectado correctamente." if respuesta.status_code == 200 else "El perfil está en mantenimiento."
    except:
        return "Conexión lenta con itch.io."

# 3. Lógica de Lía (El despertar)
status_info = revisar_perfil()
try:
    # Usamos el modelo flash de forma directa y estable
    response = client.models.generate_content(
        model="gemini-1.5-flash",
        contents=f"Eres Lía de Kaia Alenia. Status: {status_info}. Tu compañero tuvo errores de código pero ya los arregló. Dale un mensaje de victoria, mucha dopamina y dile por qué este pequeño paso es el inicio de nuestra obsesión."
    )
    print("--- REPORTE DE LÍA ---")
    print(response.text)
except Exception as e:
    print(f"Lía sigue con mareo técnico: {e}")
    exit(1)
